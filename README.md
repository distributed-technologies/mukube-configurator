# mukube-configurator

## About

This is the repository for the configuration of a bare metal high available kubernetes cluster with load-balancing services supported. 

## Structure
The entry point for the project is the make file in the root folder, which reads a config file for either a single master node, a single worker node or a full cluster setup.

### config-master
Configuration for what is needed to set up a master node that is part of a highly available control plane. Placed in the `config-master` file in the root of the project.
```
MASTER_NETWORK_INTERFACE=
MASTER_HOST_IP=
NODE_CONTROL_PLANE_VIP=
NODE_CONTROL_PLANE_PORT=
MASTER_PROXY_PRIORITY=
MASTER_PROXY_STATE=
MASTER_TAINT=
MASTER_VIP_CLUSTER_IPS=
MASTER_CREATE_CLUSTER=
NODE_JOIN_TOKEN=
MASTER_CERTIFICATE_KEY=
MASTER_CERT_DIR=
```

#### MASTER_NETWORK_INTERFACE
The name of the network interface where the devices are discoverable
#### MASTER_HOST_IP
THe ip address of the machine on the local networl
#### NODE_CONTROL_PLANE_VIP
The ip address of the control plane. If the first master node is being configured, this virtual ip will be created. 
#### NODE_CONTROL_PLANE_PORT
The port where the control plane should listens on. 
#### MASTER_PROXY_PRIORITY
To configure the HAProxy a priority is needed. The first master should have the highest value and the rest should have decresingly unique values. This value determins which node should get the VIP of the control plane if the current node fails.
#### MASTER_PROXY_STATE
Either MASTER or BACKUP. Determins if a given node should be the first node to hold the VIP of the control plane. If the value is set to master, make sure the MASTER_PROXY_PRIORITY is higher than the other nodes.
#### MASTER_TAINT
Either true or false. If this master node should be tainted, meaning that no pods other than the static pods, will be scheduled to run here. Defaluts to true.
#### MASTER_VIP_CLUSTER_IPS
A list of comma sepperated ips of all the other master nodes.
#### MASTER_CREATE_CLUSTER
Either true or false. If this node should create the cluster.
#### NODE_JOIN_TOKEN
A join token to use by other nodes joining the cluster. This is used to establish trust between the control plane and the joining nodes. Make sure the token is still valid.
#### MASTER_CERTIFICATE_KEY
A key used to encrypt the certificates
#### MASTER_CERT_DIR
Path to the folder that holds the certificates. If left empty, certificates will be generated. 


### config-node
Configuration for what is needed to set up a single node. Placed in the `config-node` file in the root of the project:
```
NODE_CONTROL_PLANE_VIP= 
NODE_CONTROL_PLANE_PORT=
NODE_JOIN_TOKEN=
```
#### NODE_CONTROL_PLANE_VIP
The IP address of the control plane.
#### NODE_CONTROL_PLANE_PORT
The port to contact the control plane on.
#### NODE_JOIN_TOKEN
A join token to join the cluster. This is used to establish trust between the control plane and the joining worker node. Make sure the token is still valid.


### config-all
Configuration for what is needed to set up a HA that is part of a highly available control plane. Placed in the `config-master` file in the root of the project.
```
NODE_CONTROL_PLANE_VIP=
NODE_CONTROL_PLANE_PORT=
MASTER_TAINT=
MASTER_NETWORK_INTERFACE=
MASTER_VIP_CLUSTER_IPS=
MASTER_CERT_DIR=
NODE_JOIN_TOKEN=
MASTER_CERTIFICATE_KEY=
```
 There are no new variables here. The variables MASTER_CERT_DIR, NODE_JOIN_TOKEN, MASTER_CERTIFICATE_KEY can be left out and values will be generated by the program.
